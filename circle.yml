machine:
  environment:
    FILENAME: report

dependencies:
  cache_directories:
    - "~/.apt-cache"
  pre:
    - |
      sudo rm -rf /var/cache/apt/archives && \
      sudo ln -s ~/.apt-cache /var/cache/apt/archives && \
      mkdir -p ~/.apt-cache/partial
  override:
    - sudo apt-get update
    - sudo apt-get install -y texlive texlive-xetex texlive-latex-extra pandoc lmodern

test:
  override:
    - |
      cd tex
      pandoc --variable=geometry:a4paper --highlight-style pygments --mathjax \
             --latex-engine=xelatex "$FILENAME.tex" -o "$FILENAME.pdf"
    - cp -r "tex/$FILENAME.pdf" $CIRCLE_ARTIFACTS/
